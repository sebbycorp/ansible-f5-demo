---
  - name: GRAB F5 FACTS
    hosts: lb
    connection: local
    gather_facts: false
    vars:
      provider:
        server: "{{private_ip}}"
        user: "{{ansible_user}}"
        password: "{{ansible_ssh_pass}}"
        server_port: 443
        validate_certs: false
  
    tasks:
      - name: Create a pool
        bigip_pool:
          provider: "{{ provider }}"
          lb_method: ratio-member
          name: web
          slow_ramp_time: 120
          monitors:
            - http      
  
      - name: Add members to pool
        bigip_pool_member:
          provider: "{{ provider }}"
          description: "webserver {{ item.name }}"
          host: "{{ item.host }}"
          name: "{{ item.name }}"
          pool: web
          port: 80
        with_items:
          - host: 10.10.10.10
            name: web01
          - host: 10.10.10.20
            name: web02
  
      - name: Create a VIP
        bigip_virtual_server:
          provider: "{{ provider }}"
          description: foo-vip
          destination: 172.16.10.108
          name: vip-1
          pool: web
          port: 80
          snat: Automap
          profiles:
            - http
            - clientssl
        delegate_to: localhost